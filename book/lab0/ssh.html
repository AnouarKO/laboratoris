<!DOCTYPE HTML>
<html lang="ca" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Conexió remota a la màquina virtual - Laboratoris de Sistemes Operatius per a estudiants del Grau en Enginyeria Informàtica</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Laboratoris generals</li><li class="chapter-item expanded "><a href="../lab0/main.html"><strong aria-hidden="true">1.</strong> Laboratori 0</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../lab0/vm-install.html"><strong aria-hidden="true">1.1.</strong> Instal·lació de la màquina virtual</a></li><li class="chapter-item expanded "><a href="../lab0/ssh.html" class="active"><strong aria-hidden="true">1.2.</strong> Conexió remota a la màquina virtual</a></li><li class="chapter-item expanded "><a href="../lab0/vscode.html"><strong aria-hidden="true">1.3.</strong> Configuració VS Code</a></li><li class="chapter-item expanded "><a href="../lab0/git.html"><strong aria-hidden="true">1.4.</strong> Configuració Git/Github</a></li><li class="chapter-item expanded "><a href="../lab0/dev.html"><strong aria-hidden="true">1.5.</strong> Configurant entorn de treball</a></li><li class="chapter-item expanded "><a href="../lab0/project0.html"><strong aria-hidden="true">1.6.</strong> Projecte Col·laboratiu: Calculadora</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Laboratoris de Sistemes Operatius per a estudiants del Grau en Enginyeria Informàtica</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="conexió-remota-a-la-màquina-virtual"><a class="header" href="#conexió-remota-a-la-màquina-virtual">Conexió remota a la màquina virtual</a></h1>
<p>En els nostres laboratoris, utilitzarem la màquina virtual per realitzar tots els experiments i com a entorn de desenvolupament. Per facilitar la gestió s'acosutma a utilitzar els protocols SSH, SFTP i SCP per connectar-se a la màquina virtual i transferir fitxers entre la vostra màquina local i la màquina virtual.</p>
<blockquote>
<p>ℹ️ Què és SSH?</p>
<p>SSH (Secure Shell) és un protocol de xarxa que permet als usuaris connectar-se a un dispositiu remot de forma segura. SSH utilitza una connexió xifrada per autenticar els usuaris i protegir les dades que es transmeten entre els dispositius. Això fa que SSH sigui una eina molt útil per connectar-se a servidors remots de forma segura.</p>
</blockquote>
<hr />
<blockquote>
<p>ℹ️ Què és SFTP?</p>
<p>SFTP (SSH File Transfer Protocol) és un protocol de transferència de fitxers que permet als usuaris transferir fitxers de forma segura entre dos dispositius. SFTP utilitza SSH per autenticar els usuaris i xifrar les dades que es transmeten entre els dispositius. Això fa que SFTP sigui una eina molt útil per transferir fitxers de forma segura entre servidors remots.</p>
</blockquote>
<hr />
<blockquote>
<p>ℹ️ Què és secure copy (SCP)?</p>
<p>SCP (Secure Copy) és una eina que permet als usuaris copiar fitxers de forma segura entre dos dispositius utilitzant SSH. SCP utilitza SSH per autenticar els usuaris i xifrar les dades que es transmeten entre els dispositius.</p>
</blockquote>
<h2 id="connexió-ssh-entre-la-vostra-màquina-i-la-màquina-virtual"><a class="header" href="#connexió-ssh-entre-la-vostra-màquina-i-la-màquina-virtual">Connexió SSH entre la vostra màquina i la màquina virtual</a></h2>
<p>Per connectar-vos a una màquina virtual utilitzant SSH, necessitareu l'adreça IP de la màquina virtual o bé el <code>hostname</code> de la màquina virtual. A més, necessitareu un client SSH instal·lat al vostre sistema local.</p>
<p>Per obtenir l'adreça IP de la màquina virtual, podeu utilitzar la interfície gràfica de <em>VMWare</em> o bé executar la comanda <code>ip a</code> a la màquina virtual per obtenir la informació de la xarxa.</p>
<ul>
<li>
<p>Interfície gràfica de <em>VMWare</em>:</p>
<p><img src="./figures/ssh-sftp/ip-vmware.png" alt="Adreça IP de la màquina virtual" /></p>
</li>
<li>
<p>Executar la comanda <code>ip a</code> a la màquina virtual:</p>
<pre><code class="language-bash">ip a
</code></pre>
<p><img src="./figures/ssh-sftp/ip-a.png" alt="Adreça IP de la màquina virtual" /></p>
<p>En el meu cas, l'adreça IP de la màquina virtual és <code>172.16.10.202</code>.</p>
</li>
</ul>
<blockquote>
<p>💡 Info :</p>
<p>Per defecte, VMWare utilitza una xarxa NAT per connectar les màquines virtuals. Per fer-ho, VMWare crea una xarxa privada a la qual es connecten les màquines virtuals i utilitza la xarxa de l'amfitrió per connectar-se a Internet. Això permet a les màquines virtuals connectar-se a Internet a través de l'amfitrió sense necessitat de configurar una xarxa addicional. Ara bé, això també significa que les màquines virtuals utilitzen una adreça IP privada que no és accessible des de l'exterior. Tot i això, aquesta configuració la podeu canviar si cal. Però, pels nostres laboratoris, aquesta configuració és suficient.</p>
</blockquote>
<p>A continuació, us mostrem com connectar-vos a una màquina virtual utilitzant SSH:</p>
<ul>
<li>
<p>Mac/Linux:</p>
<pre><code class="language-bash">ssh &lt;usuari&gt;@&lt;adreça IP o hostname&gt;
</code></pre>
</li>
</ul>
<p><img src="./figures/ssh-sftp/ssh.png" alt="Exemple de connexió SSH" /></p>
<p><strong>On</strong>: <code>&lt;usuari&gt;</code> és el nom d'usuari amb el qual voleu connectar-vos a la màquina virtual i  <code>&lt;adreça IP o hostname&gt;</code> és l'adreça IP o el <code>hostname</code> de la màquina virtual a la qual voleu connectar-vos.</p>
<blockquote>
<p><strong>⚠️ Compte!</strong></p>
<p>Per defecte, Debian no permet l'accés remot amb l'usuari <code>root</code>. Per tant, si voleu connectar-vos a la màquina virtual com a <code>root</code>, primer heu de connectar-vos com a usuari normal i després canviar a l'usuari <code>root</code> amb la comanda <code>su</code>.</p>
<p><img src="./figures/ssh-sftp/ssh-root.png" alt="Exemple de connexió SSH com a root" /></p>
</blockquote>
<p>Un cop connectats, podreu interactuar amb la màquina virtual com si estiguéssiu connectats físicament a la màquina. Per sortir de la sessió SSH, executeu la comanda <code>exit</code>.</p>
<ul>
<li>Windows: Obrir una sessió de PowerShell i executar la comanda anterior. També podeu utilitzar un client SSH com <a href="https://www.putty.org/">PuTTY</a>.</li>
</ul>
<blockquote>
<p>ℹ️ Què és el fingerprint que es mostra quan connecteu per primera vegada a un servidor SSH?</p>
<p>El fingerprint és una empremta digital única que identifica un servidor SSH. Quan connecteu per primera vegada a un servidor SSH, el vostre client SSH us mostrarà el fingerprint del servidor perquè pugueu verificar que esteu connectant-vos al servidor correcte. Això us protegeix contra atacs de suplantació de servidor.</p>
</blockquote>
<hr />
<blockquote>
<p>😵‍💫 Troubleshooting:</p>
<p>Si una IP d'una màquina virtual a la qual havíeu accedit prèviament es reassigna a una altra màquina virtual i intenteu accedir a la màquina virtual original, el client SSH mostrarà un missatge d'advertència. Això succeeix perquè el fingerprint del servidor ha canviat. Quan connecteu per primera vegada a un servidor SSH, el vostre client SSH emmagatzema aquest fingerprint en el fitxer <code>~/.ssh/known_hosts</code> per a futures referències.</p>
<p>Si el fingerprint del servidor canvia (per exemple, perquè l'adreça IP s'ha reassignat a una altra màquina virtual), el client SSH detectarà aquesta discrepància i mostrarà un missatge d'advertència per protegir-vos contra possibles atacs de suplantació de servidor. Aquest missatge us informa que el servidor al qual esteu intentant connectar-vos no coincideix amb el fingerprint emmagatzemat.</p>
<p>Per resoldre aquest problema i poder connectar-vos al servidor, podeu eliminar l'entrada del servidor del fitxer <code>~/.ssh/known_hosts</code>. Això permetrà al client SSH acceptar el nou fingerprint i establir la connexió sense mostrar l'advertència.</p>
<p>Per resoldre aquest problema, simplement elimineu l'entrada del servidor del fitxer <code>~/.ssh/known_hosts</code> i torneu a intentar connectar-vos al servidor. En el sistema operatiu Windows, el fitxer <code>known_hosts</code> es troba a la carpeta <code>C:\Users\&lt;usuari&gt;\.ssh\known_hosts</code>.</p>
</blockquote>
<h2 id="transferència-de-fitxers-amb-sftp"><a class="header" href="#transferència-de-fitxers-amb-sftp">Transferència de fitxers amb SFTP</a></h2>
<p>Per transferir fitxers entre la vostra màquina local i la màquina virtual utilitzant SFTP, necessitareu l'adreça IP de la màquina virtual o bé el <code>hostname</code> de la màquina virtual. A més, necessitareu un client SFTP instal·lat al vostre sistema local. A continuació, us mostrem com transferir fitxers entre la vostra màquina local i la màquina virtual utilitzant SFTP:</p>
<ul>
<li>
<p>Mac/Linux:</p>
<pre><code class="language-bash">sftp &lt;usuari&gt;@&lt;adreça IP o hostname&gt;:&lt;ruta&gt;
</code></pre>
<p>On:</p>
<ul>
<li><code>&lt;ruta&gt;</code> és la ruta al directori de la màquina virtual on voleu transferir els fitxers.</li>
<li>Els fitxers es transferiran al directori actual de la vostra màquina local.</li>
</ul>
<p>Un cop connectats, podeu utilitzar les comandes <code>put</code> i <code>get</code> per transferir fitxers entre la vostra màquina local i la màquina virtual. Si voleu transferir un directori sencer, podeu utilitzar la comanda <code>put -r</code> o <code>get -r</code>. Per acabar la sessió SFTP, executeu la comanda <code>exit</code>.</p>
</li>
<li>
<p>Windows: Obrir una sessió de PowerShell i executar la comanda anterior. També podeu utilitzar un client SFTP com <a href="https://winscp.net/eng/index.php">WinSCP</a>.</p>
</li>
</ul>
<p>Si voleu fer servir SCP en lloc de SFTP, podeu utilitzar la comanda <code>scp</code> en lloc de <code>sftp</code>. La sintaxi de la comanda <code>scp</code> és similar a la de la comanda <code>cp</code> de Linux. Per exemple, per copiar un fitxer de la vostra màquina local a la màquina virtual, executeu la següent comanda:</p>
<pre><code class="language-bash">scp &lt;fitxer&gt; &lt;usuari&gt;@&lt;adreça IP o hostname&gt;:&lt;ruta&gt;
</code></pre>
<p>on:</p>
<ul>
<li><code>&lt;fitxer&gt;</code> és el fitxer que voleu copiar.</li>
<li><code>&lt;ruta&gt;</code> és la ruta al directori de la màquina virtual on voleu copiar el fitxer.</li>
<li>El fitxer es copiarà al directori especificat de la màquina virtual.</li>
<li>Si voleu copiar un directori sencer, podeu utilitzar l'opció <code>-r</code>.</li>
</ul>
<h3 id="exemple-pràctic-de-transferència-de-fitxers"><a class="header" href="#exemple-pràctic-de-transferència-de-fitxers">Exemple pràctic de transferència de fitxers</a></h3>
<ol>
<li>
<p>Crear un fitxer <code>fitxer.txt</code> a la vostra màquina local.</p>
<pre><code class="language-bash">echo "Aquest és un fitxer de prova" &gt; fitxer.txt
</code></pre>
</li>
<li>
<p>Copia el fitxer <code>fitxer.txt</code> a la màquina virtual a la ruta <code>/home/usuari</code>.</p>
<ul>
<li>Amb scp:</li>
</ul>
<pre><code class="language-bash">scp fitxer.txt jordi@172.16.10.202:/home/jordi
</code></pre>
<ul>
<li>Amb sftp:</li>
</ul>
<pre><code class="language-bash">sftp jordi@172.16.10.199:/home/jordi
put fitxer.txt
</code></pre>
</li>
<li>
<p>Edita el fitxer <code>fitxer.txt</code> a la màquina virtual.</p>
<pre><code class="language-bash">echo "Aquest és un fitxer de prova editat" &gt; fitxer.txt
</code></pre>
</li>
<li>
<p>Copia el fitxer <code>fitxer.txt</code> de la màquina virtual a la vostra màquina local.</p>
<pre><code class="language-bash">sftp jordi@172.16.10.202:/home/jordi
get fitxer.txt
</code></pre>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../lab0/vm-install.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../lab0/vscode.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../lab0/vm-install.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../lab0/vscode.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../editor.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
